<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>HOONIGAN.06 - Street Racing Timers</title>
  <!-- CSS CRITIQUE DE DERNIER RECOURS -->
  <style>
    @media screen and (max-width: 768px) {
      .leaflet-map-pane, .leaflet-tile, .leaflet-marker-icon, .leaflet-marker-shadow, 
      .leaflet-tile-container, .leaflet-pane, .leaflet-tooltip, .leaflet-popup, 
      .leaflet-control, .leaflet-zoom-box {
        position: absolute !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        z-index: 1 !important;
      }
      
      .leaflet-tile-container img {
        width: 256px !important;
        height: 256px !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
      }
      
      .leaflet-container {
        background: #f2f2f2 !important;
        position: relative !important;
      }
    }
  </style>

  <!-- FIX TUILES PRIORITE ABSOLUE -->
  <style id="critical-map-fix">
    /* GARANTIE AFFICHAGE TUILES MOBILE */
    .leaflet-tile-container img,
    .leaflet-tile-pane img,
    .leaflet-tile,
    .leaflet-tile-loaded {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      z-index: 1 !important;
    }
    .leaflet-container {
      background-color: #f2f2f2 !important;
    }
  </style>
  <!-- Mise √† jour v3.1 - Optimisations Service Worker -->

  <!-- PWA MANIFEST ET META TAGS -->
  <link rel="manifest" href="manifest.json"><meta name="theme-color" content="#4CAF50">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ChronoTime">
  <meta name="description" content="Application de gestion et chronom√©trage de courses sportives">

  <!-- ICONES PWA -->
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
  <link rel="stylesheet" href="initial-d-style.css">

  <link rel="stylesheet" href="mobile-redesign.css">
  <link rel="stylesheet" href="admin-style.css">
  <link rel="stylesheet" href="ux-polish.css">
  <link rel="stylesheet" href="mobile-fixes.css">
  <link rel="stylesheet" href="map-isolation.css">
  <link rel="stylesheet" href="map-isolation-enhanced.css">
  <link rel="stylesheet" href="footer-fix.css">
  <!-- Police Teko pour le style japonais r√©tro -->
  <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Leaflet et OpenStreetMap (100% gratuit, sans API key) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="map.js" defer></script>
  <script src="logo.js" defer></script>
  <script src="admin-functions.js" defer></script>
  <script src="admin-check.js" defer></script>

  <!-- CSS MOBILE PERFORMANCE - EN DERNIER POUR √âCRASER TOUT -->
  <link rel="stylesheet" href="mobile-performance.css">
</head>
<body>
  <!-- Effet scanlines pour le style r√©tro -->
  <div class="scanlines"></div>
  <!-- Grille r√©tro en arri√®re-plan -->
  <div class="retro-grid"></div>
  <div id="root"></div>

  <!-- Chargement des biblioth√®ques React -->
  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js" crossorigin></script>

  <!-- Rendre Leaflet disponible globalement -->
  <script>
    window.L = L;
  </script>

  <!-- SERVICE WORKER TEMPORAIREMENT D√âSACTIV√â POUR DEBUG TUILES -->
  <!-- <script src="sw-enable.js"></script> -->
  
  <!-- SCRIPT POUR D√âSACTIVER SERVICE WORKER EXISTANT -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for(let registration of registrations) {
          console.log('üóëÔ∏è D√©sactivation Service Worker:', registration.scope);
          registration.unregister();
        }
      });
      console.log('üö® SERVICE WORKER D√âSACTIV√â POUR DEBUG TUILES');
    }
  </script>

  <!-- Scripts JavaScript -->
  <!-- SCRIPTS TEMPORAIREMENT D√âSACTIV√âS POUR DEBUG TUILES MOBILE -->
  <!-- <script src="smooth-interactions.js"></script> -->
  <!-- <script src="mobile-logout.js"></script> -->
  <!-- <script src="mobile-tile-diagnostic.js"></script> -->
  <!-- <script src="mobile-map-ultimate-fallback.js"></script> -->
  <!-- Scripts carte mobile d√©sactiv√©s - remplac√©s par le syst√®me unifi√© -->
  <!-- CONFIGURATION CARTE ORIGINALE -->
  <!-- map.js d√©j√† charg√© en <head> avec defer -->

  <!-- Suppression du mode desktop forc√© sur mobile (cassait l'UI) -->

  <!-- PWA INSTALLATION ET MODE HORS-LIGNE -->
  <script src="pwa-install.js"></script>

  <!-- Am√©liorations UX/UI -->
  <link rel="stylesheet" href="responsive.css">
  <!-- <link rel="stylesheet" href="accessibility-improvements.css"> -->
  <!-- <link rel="stylesheet" href="advanced-animations.css"> -->
  <!-- mobile-navigation.js d√©sactiv√©: provoquait des positions fixed et animations ind√©sirables sur mobile -->
  <!-- SCRIPTS D√âSACTIV√âS POUR DEBUG TUILES -->
  <!-- <script src="ux-improvements.js"></script> -->
  <!-- <script src="performance-optimizations.js"></script> -->
  <!-- <script src="accessibility-enhancements.js"></script> -->
  <!-- <script src="theme-system.js"></script> -->
  <!-- <script src="pwa-system-clean.js"></script> -->

  <!-- <script src="mobile-interactions.js"></script> -->

  <!-- API pour communiquer avec le backend -->
  <script src="api.js"></script>

  <!-- Application principale -->
  <script type="text/babel" src="app.js"></script>

  <!-- Script de d√©bogage pour afficher les erreurs -->
  <script>
    window.onerror = function(message, source, lineno, colno, error) {
      const errorDiv = document.createElement('div');
      errorDiv.style.backgroundColor = '#ffebee';
      errorDiv.style.color = '#d32f2f';
      errorDiv.style.padding = '20px';
      errorDiv.style.margin = '20px';
      errorDiv.style.borderRadius = '8px';
      errorDiv.style.fontFamily = 'monospace';
      errorDiv.innerHTML = `<h3>Erreur JavaScript</h3>
        <p><strong>Message:</strong> ${message}</p>
        <p><strong>Source:</strong> ${source}</p>
        <p><strong>Ligne:</strong> ${lineno}, <strong>Colonne:</strong> ${colno}</p>
        <p><strong>Stack:</strong> ${error && error.stack ? error.stack.replace(/\n/g, '<br>') : 'Non disponible'}</p>`;
      document.body.prepend(errorDiv);
      return true;
    };
    
    // SOLUTION RADICALE POUR FORCER LES STYLES APR√àS REACT
    function forceBeautifulBackgrounds() {
      const elementsToFix = [
        '.tabs', '.nav-tabs', '.card', '.auth-tabs', '.auth-form', 
        '.user-info', '.app-header', '.tab', '.auth-tab'
      ];
      
      elementsToFix.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        elements.forEach(el => {
          if (el) {
            el.style.background = 'linear-gradient(135deg, rgba(40,40,40,0.95) 0%, rgba(25,25,25,0.98) 100%)';
            el.style.backdropFilter = 'blur(10px)';
            el.style.boxShadow = '0 4px 15px rgba(255, 0, 0, 0.3)';
            
            // Forcer la couleur du texte selon l'√©tat
            if (el.classList.contains('active')) {
              el.style.color = '#000000';
              el.style.fontWeight = 'bold';
            } else {
              el.style.color = '#ffffff';
            }
          }
        });
      });
    }
    
    // Ex√©cuter imm√©diatement et apr√®s chaque changement
    forceBeautifulBackgrounds();
    
    // Observer les changements DOM pour React
    const observer = new MutationObserver(() => {
      forceBeautifulBackgrounds();
    });
    
    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
    
    // Forcer apr√®s un d√©lai pour √™tre s√ªr
    setTimeout(forceBeautifulBackgrounds, 1000);
    setTimeout(forceBeautifulBackgrounds, 3000);
    
    // ANIMATIONS FLUIDES MODERNES - QUALIT√â 2025
    function initModernAnimations() {
      // Scroll fluide avec inertie
      document.documentElement.style.scrollBehavior = 'smooth';
      
      // Gestion des micro-interactions tactiles
      const interactiveElements = document.querySelectorAll('.tab, .auth-tab, button, .card');
      
      interactiveElements.forEach(el => {
        // Pas d'animation mobile - Interface propre
        
        // Animation au survol (desktop) - Sans flou
        el.addEventListener('mouseenter', (e) => {
          if (el.classList.contains('tab') || el.classList.contains('auth-tab')) {
            el.style.filter = 'brightness(1.1)';
            el.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
          } else {
            el.style.filter = 'brightness(1.05)';
            el.style.boxShadow = '0 6px 15px rgba(0, 0, 0, 0.1)';
          }
          el.style.transition = 'all 200ms cubic-bezier(0.34, 1.56, 0.64, 1)';
        });
        
        el.addEventListener('mouseleave', (e) => {
          if (!el.classList.contains('active')) {
            el.style.filter = '';
            el.style.boxShadow = '';
          }
          el.style.transition = 'all 350ms cubic-bezier(0.16, 1, 0.3, 1)';
        });
      });
      
      // Optimisation du scroll pour mobile
      if (window.innerWidth <= 768) {
        document.body.style.webkitOverflowScrolling = 'touch';
        document.body.style.overscrollBehavior = 'contain';
        
        // Gestion du momentum scrolling
        let isScrolling = false;
        window.addEventListener('scroll', () => {
          if (!isScrolling) {
            requestAnimationFrame(() => {
              // Optimisations pendant le scroll
              isScrolling = false;
            });
            isScrolling = true;
          }
        }, { passive: true });
      }
    }
    
    // Initialiser les animations modernes
    initModernAnimations();
    
    // R√©initialiser apr√®s les changements DOM
    const animationObserver = new MutationObserver(() => {
      setTimeout(initModernAnimations, 100);
    });
    
    animationObserver.observe(document.body, {
      childList: true,
      subtree: true
    });
  </script>
</body>
</html>
